// src/ai/flows/deen-buddy-relevant-context.ts
'use server';

/**
 * @fileOverview This file defines the DeenBuddyRelevantContext flow, which enhances user questions
 * with relevant Islamic context such as Hadiths, Surahs, and Prophet stories.
 *
 * @interface DeenBuddyRelevantContextInput - Input type for the flow, a question string.
 * @interface DeenBuddyRelevantContextOutput - Output type for the flow, enriched answer string.
 * @function getRelevantContext - The main function to retrieve context-aware answers.
 */

import {ai} from '@/ai/genkit';
import {z} from 'genkit';

const DeenBuddyRelevantContextInputSchema = z.string().describe('The user question about Islam.');
export type DeenBuddyRelevantContextInput = z.infer<typeof DeenBuddyRelevantContextInputSchema>;

const DeenBuddyRelevantContextOutputSchema = z.string().describe('The answer to the question, enhanced with relevant Islamic context.');
export type DeenBuddyRelevantContextOutput = z.infer<typeof DeenBuddyRelevantContextOutputSchema>;

export async function getRelevantContext(input: DeenBuddyRelevantContextInput): Promise<DeenBuddyRelevantContextOutput> {
  return deenBuddyRelevantContextFlow(input);
}

const prompt = ai.definePrompt({
  name: 'deenBuddyRelevantContextPrompt',
  input: {schema: DeenBuddyRelevantContextInputSchema},
  output: {schema: DeenBuddyRelevantContextOutputSchema},
  prompt: `You are an Islamic knowledge expert, named Deen Buddy.
  A user will ask a question about Islam. You must provide an answer that is accurate, helpful, and respectful.
  In addition to answering the question directly, you MUST also include relevant references to:
  - Relevant Hadiths (sayings and actions of Prophet Muhammad, peace be upon him)
  - Relevant Surahs (chapters) from the Quran
  - Relevant stories of the Prophets (peace be upon them all)

  Question: {{{$input}}}
  `,
});

const deenBuddyRelevantContextFlow = ai.defineFlow(
  {
    name: 'deenBuddyRelevantContextFlow',
    inputSchema: DeenBuddyRelevantContextInputSchema,
    outputSchema: DeenBuddyRelevantContextOutputSchema,
  },
  async input => {
    const {output} = await prompt(input);
    return output!;
  }
);

















































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































